@startuml business3_submission
Title 执行层交易业务 / 交易提交 细化流程

start

partition "用户与应用" {
  :DApp / 钱包 读取链上状态 (RPC: eth_call / eth_getBalance / eth_getBlockByNumber);
  :根据应用逻辑构造交易参数\n(to, value, data, gasLimit, maxFeePerGas, maxPriorityFeePerGas, nonce);
  :本地使用私钥对交易进行签名\n(ECDSA, secp256k1);
}

partition "提交路径" {
  if (公共 mempool 提交?) then (是)
    :通过 JSON-RPC (eth_sendRawTransaction)\n将签名交易发送到执行客户端;
  else (私有 / MEV 订单流)
    :通过专用端点 (如 Flashbots / Builder API)\n提交交易或 Bundle 到特定 Relay / Builder;
  endif
}

partition "执行客户端接收" {
  :执行客户端验证 RLP/SSZ 编码与字段范围;
  :验证签名与 nonce 是否正确,\n检查基础费用与 gas 限制是否合理;
  if (基本检查失败?) then (是)
    :拒绝交易, 返回错误给调用者 (RPC error);
    stop
  endif

  :'放入交易池 (txpool)';
  :按照 gasPrice / feePriority 等策略，将交易插入本地 txpool 结构;
  :通过执行层 P2P 协议向其它节点 gossip 交易\n(避免重复, 遵守大小 / 频率限制);
}

partition "等待打包" {
  :交易在 txpool 中等待被未来的执行层打包器\n(本地 miner/builder 或外部 MEV Builder) 选中;
}

stop

@enduml
